<%! from django.core.urlresolvers import reverse %>
<%! from django.utils.translation import ugettext as _ %>

<!--<%namespace name='static' file='/static_content.html'/>-->

<%inherit file="/main.html" />
<%namespace name='static' file='/static_content.html'/>

<%block name="pagetitle">${_("Account Settings")}</%block>

<%block name="js_extra">
    <script type="text/javascript" src="${static.url('js/vendor/underscore-min.js')}"></script>
    <script type="text/javascript" src="${static.url('js/vendor/backbone-min.js')}"></script>

     <script type="text/javascript" src="${static.url('js/student_account/views/AccountSettingsView.js')}"></script>
     <script type="text/javascript" src="${static.url('js/student_account/models/AccountSettingsModel.js')}"></script>

    <%static:js group='student_account'/>
</%block>

<%block name="header_extras">
    % for template_name in ["account_settings", "field_dropdown", "field_link", "field_readonly", "field_text"]:
        <script type="text/template" id="${template_name}-tpl">
            <%static:include path="student_account/${template_name}.underscore" />
        </script>
    % endfor
</%block>

<div class="account-settings-container"
     data-accounts-api-url="${accounts_api_url}">
</div>

<%block name="headextra">
    <%static:css group='style-course'/>

    <script>
        $(document).ready(function() {

            var accountSettingsElement = $('.account-settings-container');
            var accountSettingsModel = new edx.student.account.AccountSettingsModel();
            accountSettingsModel.url = accountSettingsElement.data('accounts-api-url');

            var accountSettingsView = new edx.student.account.AccountSettingsView({
                el: accountSettingsElement,
                model: accountSettingsModel,
                context: {
                    accountSettingsModelUrl: accountSettingsModel.url
                },
                sections : [
                    {
                        title: "Basic Account Information",
                        fields: [
                            {
                                view: new edx.student.account.ReadonlyFieldView({
                                    model: accountSettingsModel,
                                    title: "Username",
                                    value_attribute: "username",
                                    message: ""
                                })
                            },
                            {
                                view: new edx.student.account.TextFieldView({
                                    model: accountSettingsModel,
                                    title: "Full Name",
                                    value_attribute: "name",
                                    message: "This is used on your edX certificates, and all changes are reviewed."
                                })
                            },
                            {
                                view: new edx.student.account.TextFieldView({
                                    model: accountSettingsModel,
                                    title: "Email",
                                    value_attribute: "email",
                                    message: "You account email is used as a login mechanism and for course communications."
                                })
                            },
                            {
                                view: new edx.student.account.LinkFieldView({
                                    model: accountSettingsModel,
                                    title: "Password",
                                    value_attribute: "password",
                                    link_title: "Reset Password",
                                    link_href: "${reverse('password_reset')}",
                                    message: "To reset your password you'll need to click the reset password link sent to you via email."
                                })
                            },
                            {
                                view: new edx.student.account.DropdownFieldView({
                                    model: accountSettingsModel,
                                    title: "Language",
                                    value_attribute: "language",
                                    default_value: "${ language_default }",
                                    message: "This setting controls your default edX language.",
                                    options: [
                                        % for option in language_options:
                                            ["${option[0]}", "${option[1]}"],
                                        % endfor
                                    ],
                                })
                            },
                        ]
                    },
                    {
                        title: "Demographics and Additional Details",
                        fields: [
                            {
                                view: new edx.student.account.DropdownFieldView({
                                    model: accountSettingsModel,
                                    title: "Educational Background",
                                    value_attribute: "level_of_education",
                                    default_value: null,
                                    message: "",
                                    options: [
                                        % for option in level_of_education_options:
                                            ["${option[0]}", "${option[1]}"],
                                        % endfor
                                    ],
                                })
                            },
                            {
                                view: new edx.student.account.DropdownFieldView({
                                    model: accountSettingsModel,
                                    title: "Gender",
                                    value_attribute: "gender",
                                    default_value: null,
                                    message: "",
                                    options: [
                                        % for option in gender_options:
                                            ["${option[0]}", "${option[1]}"],
                                        % endfor
                                    ],
                                })
                            },
                            {
                                view: new edx.student.account.DropdownFieldView({
                                    model: accountSettingsModel,
                                    title: "Year of Birth",
                                    value_attribute: "year_of_birth",
                                    default_value: null,
                                    message: "",
                                    options: [
                                        % for option in year_of_birth_options:
                                            ["${option[0]}", "${option[1]}"],
                                        % endfor
                                    ],
                                })
                            },
                            {
                                view: new edx.student.account.DropdownFieldView({
                                    model: accountSettingsModel,
                                    title: "Country",
                                    value_attribute: "null",
                                    default_value: null,
                                    message: "",
                                    options: [
                                        % for option in country_options:
                                            ["${option[0]}", "${option[1]}"],
                                        % endfor
                                    ],
                                })
                            },
                            {
                                view: new edx.student.account.DropdownFieldView({
                                    model: accountSettingsModel,
                                    title: "Timezone",
                                    value_attribute: "timezone",
                                    default_value: null,
                                    message: "",
                                    options: [
                                        % for option in timezone_options:
                                            ["${option[0]}", "${option[1]}"],
                                        % endfor
                                    ],
                                })
                            },
                            {
                                view: new edx.student.account.DropdownFieldView({
                                    model: accountSettingsModel,
                                    title: "Preferred Language",
                                    value_attribute: "preferred_language",
                                    default_value: null,
                                    message: "If your preferred language isn't available as an edX language, you can indicate your preferance here.",
                                    options: [
                                        % for option in preferred_language_options:
                                            ["${option[0]}", "${option[1]}"],
                                        % endfor
                                    ],
                                })
                            },
                        ]
                    },
                    {
                        title: "Connected Accounts",
                        fields: [
                            {
                                view: new edx.student.account.LinkFieldView({
                                    model: accountSettingsModel,
                                    title: "Facebook",
                                    link_title: "Link",
                                    link_href: "",
                                    message: ""
                                })
                            },
                            {
                                view: new edx.student.account.LinkFieldView({
                                    model: accountSettingsModel,
                                    title: "Google",
                                    link_title: "Link",
                                    link_href: "",
                                    message: ""
                                })
                            },
                        ]
                    }
                ]
            });

            accountSettingsView.render();
            accountSettingsModel.fetch().done(function(data, textStatus, jqXHR) {
                accountSettingsView.setup_fields();
            });
        });
    </script>

</%block>
