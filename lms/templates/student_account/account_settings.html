<%! from django.core.urlresolvers import reverse %>
<%! from django.utils.translation import ugettext as _ %>

<!--<%namespace name='static' file='/static_content.html'/>-->

<%inherit file="/main.html" />
<%namespace name='static' file='/static_content.html'/>

<%block name="pagetitle">${_("Account Settings")}</%block>

<%block name="js_extra">
    <script type="text/javascript" src="${static.url('js/vendor/underscore-min.js')}"></script>
    <script type="text/javascript" src="${static.url('js/vendor/backbone-min.js')}"></script>

     <script type="text/javascript" src="${static.url('js/student_account/views/AccountSettingsView.js')}"></script>
     <script type="text/javascript" src="${static.url('js/student_account/models/AccountSettingsModel.js')}"></script>

    <%static:js group='student_account'/>
</%block>

<%block name="header_extras">
    % for template_name in ["account_settings", "field_dropdown", "field_link", "field_readonly", "field_text"]:
        <script type="text/template" id="${template_name}-tpl">
            <%static:include path="student_account/${template_name}.underscore" />
        </script>
    % endfor
</%block>

<div class="account-settings-container"
     data-accounts-api-url="${accounts_api_url}">
</div>

<%block name="headextra">
    <%static:css group='style-course'/>

    <script>
        $(document).ready(function() {

            var accountSettingsElement = $('.account-settings-container');
            var accountSettingsModel = new edx.student.account.AccountSettingsModel();
            accountSettingsModel.url = accountSettingsElement.data('accounts-api-url');

            var accountSettingsView = new edx.student.account.settingsViews.AccountSettingsView({
                el: accountSettingsElement,
                model: accountSettingsModel,
                context: {
                    accountSettingsModelUrl: accountSettingsModel.url
                },
                sections : [
                    {
                        title: "Basic Account Information",
                        fields: [
                            {
                                view: new edx.student.account.settingsViews.ReadonlyFieldView({
                                    model: accountSettingsModel,
                                    title: "Username",
                                    valueAttribute: "username",
                                    message: ""
                                })
                            },
                            {
                                view: new edx.student.account.settingsViews.TextFieldView({
                                    model: accountSettingsModel,
                                    title: "Full Name",
                                    valueAttribute: "name",
                                    message: "This is used on your edX certificates, and all changes are reviewed."
                                })
                            },
                            {
                                view: new edx.student.account.settingsViews.TextFieldView({
                                    model: accountSettingsModel,
                                    title: "Email",
                                    valueAttribute: "email",
                                    message: "You account email is used as a login mechanism and for course communications."
                                })
                            },
                            {
                                view: new edx.student.account.settingsViews.LinkFieldView({
                                    model: accountSettingsModel,
                                    title: "Password",
                                    valueAttribute: "password",
                                    linkTitle: "Reset Password",
                                    message: "To reset your password you'll need to click the reset password link sent to you via email."
                                })
                            },
                            {
                                view: new edx.student.account.settingsViews.DropdownFieldView({
                                    model: accountSettingsModel,
                                    title: "Language",
                                    valueAttribute: "language",
                                    defaultValue: "${ fields['language']['default'] }",
                                    required: true,
                                    message: "This setting controls your default edX language.",
                                    options: [
                                        % for option in fields['language']['options']:
                                            ["${option[0]}", "${option[1]}"],
                                        % endfor
                                    ],
                                })
                            },
                        ]
                    },
                    {
                        title: "Demographics and Additional Details",
                        fields: [
                            {
                                view: new edx.student.account.settingsViews.DropdownFieldView({
                                    model: accountSettingsModel,
                                    title: "Educational Background",
                                    valueAttribute: "level_of_education",
                                    defaultValue: null,
                                    required: false,
                                    message: "",
                                    options: [
                                        % for option in fields['level_of_education']['options']:
                                            ["${option[0]}", "${option[1]}"],
                                        % endfor
                                    ],
                                })
                            },
                            {
                                view: new edx.student.account.settingsViews.DropdownFieldView({
                                    model: accountSettingsModel,
                                    title: "Gender",
                                    valueAttribute: "gender",
                                    defaultValue: null,
                                    required: false,
                                    message: "",
                                    options: [
                                        % for option in fields['gender']['options']:
                                            ["${option[0]}", "${option[1]}"],
                                        % endfor
                                    ],
                                })
                            },
                            {
                                view: new edx.student.account.settingsViews.DropdownFieldView({
                                    model: accountSettingsModel,
                                    title: "Year of Birth",
                                    valueAttribute: "year_of_birth",
                                    defaultValue: null,
                                    required: false,
                                    message: "",
                                    options: [
                                        % for option in fields['year_of_birth']['options']:
                                            ["${option[0]}", "${option[1]}"],
                                        % endfor
                                    ],
                                })
                            },
                            {
                                view: new edx.student.account.settingsViews.DropdownFieldView({
                                    model: accountSettingsModel,
                                    title: "Country",
                                    valueAttribute: "null",
                                    defaultValue: null,
                                    required: false,
                                    message: "",
                                    options: [
                                        % for option in fields['country']['options']:
                                            ["${option[0]}", "${option[1]}"],
                                        % endfor
                                    ],
                                })
                            },
                            {
                                view: new edx.student.account.settingsViews.DropdownFieldView({
                                    model: accountSettingsModel,
                                    title: "Timezone",
                                    valueAttribute: "timezone",
                                    defaultValue: null,
                                    required: false,
                                    message: "",
                                    options: [
                                        % for option in fields['timezone']['options']:
                                            ["${option[0]}", "${option[1]}"],
                                        % endfor
                                    ],
                                })
                            },
                            {
                                view: new edx.student.account.settingsViews.DropdownFieldView({
                                    model: accountSettingsModel,
                                    title: "Preferred Language",
                                    valueAttribute: "preferred_language",
                                    defaultValue: null,
                                    required: false,
                                    message: "If your preferred language isn't available as an edX language, you can indicate your preferance here.",
                                    options: [
                                        % for option in fields['preferred_language']['options']:
                                            ["${option[0]}", "${option[1]}"],
                                        % endfor
                                    ],
                               })
                            },
                        ]
                    },
                    {
                        title: "Connected Accounts",
                        fields: [
                            {
                                view: new edx.student.account.settingsViews.LinkFieldView({
                                    model: accountSettingsModel,
                                    title: "Facebook",
                                    linkTitle: "Link",
                                    message: "",
                                })
                            },
                            {
                                view: new edx.student.account.settingsViews.LinkFieldView({
                                    model: accountSettingsModel,
                                    title: "Google",
                                    linkTitle: "Link",
                                    message: "",
                                })
                            },
                        ]
                    }
                ]
            });

            accountSettingsView.render();
            accountSettingsModel.fetch().done(function(data, textStatus, jqXHR) {
                accountSettingsView.setupFields();
            });
        });
    </script>

</%block>
